invoke sigil_webÂ·preludeÂ·*;
á›ˆ WorkspacePanelMsg {
    UpdateProjects,
    UpdateProjectTrees,
    UpdateLoading,
    UpdateError,
    UpdateExpanded,
    UpdateTreeCollapsed,
    UpdateSearchQuery,
    UpdateAddDialogOpen,
    UpdateNewProjectPath,
    UpdateNewProjectName,
    UpdateAdding,
    UpdateAddError,
    UpdateRemoveConfirmOpen,
    UpdateClearConfirmOpen,
    UpdateProjectToRemove,
    AddProject,
    RemoveProject,
    ClearWorkspace,
    ToggleTreeCollapse,
}
actor WorkspacePanel {
    state projects: Vec<Any>! = [],
    state projectTrees: Option<Any>~ = âˆ…,
    state loading: bool! = true,
    state error: Option<Any>~ = None,
    state expanded: Option<Any>~ = âˆ…,
    state treeCollapsed: Any~ = None,
    state searchQuery: String! = "",
    state addDialogOpen: bool! = false,
    state newProjectPath: String! = "",
    state newProjectName: String! = "",
    state adding: bool! = false,
    state addError: Option<Any>~ = None,
    state removeConfirmOpen: bool! = false,
    state clearConfirmOpen: bool! = false,
    state projectToRemove: Option<Any>~ = None,

    on UpdateProjects {
        self.projects = msg.0;
    }

    on UpdateProjectTrees {
        self.projectTrees = msg.0;
    }

    on UpdateLoading {
        self.loading = msg.0;
    }

    on UpdateError {
        self.error = msg.0;
    }

    on UpdateExpanded {
        self.expanded = msg.0;
    }

    on UpdateTreeCollapsed {
        self.treeCollapsed = msg.0;
    }

    on UpdateSearchQuery {
        self.searchQuery = msg.0;
    }

    on UpdateAddDialogOpen {
        self.addDialogOpen = msg.0;
    }

    on UpdateNewProjectPath {
        self.newProjectPath = msg.0;
    }

    on UpdateNewProjectName {
        self.newProjectName = msg.0;
    }

    on UpdateAdding {
        self.adding = msg.0;
    }

    on UpdateAddError {
        self.addError = msg.0;
    }

    on UpdateRemoveConfirmOpen {
        self.removeConfirmOpen = msg.0;
    }

    on UpdateClearConfirmOpen {
        self.clearConfirmOpen = msg.0;
    }

    on UpdateProjectToRemove {
        self.projectToRemove = msg.0;
    }

    on AddProject {
        self.addError = 'Please enter a project path';
        self.adding = true;
        self.addError = null;
    }

    on RemoveProject {
        // TODO: implement
    }

    on ClearWorkspace {
        // TODO: implement
    }

    on ToggleTreeCollapse {
        self.treeCollapsed = newCollapsed;
        localStorage.setItem('workspace-tree-collapsed', String(newCollapsed));
    }

    on Mount {
        // Empty deps â†’ Mount lifecycle
    }

    rite view(self) -> VNode! {
        VNodeÂ·div()
            Â·class("flex flex-col h-full bg-[#1e1e1e] text-[#cccccc]")
            Â·child(
            VNodeÂ·div()
                Â·class("px-3 py-2 border-b border-[#3c3c3c] text-[13px] font-semibold")
                Â·text_child("Workspace")
            )
            Â·when(self.projects.len() > 0 âˆ§ Â¬tree_collapsed, VNodeÂ·div()
                Â·class("px-3 py-2 border-b border-[#3c3c3c]")
                Â·child(
                VNodeÂ·div()
                    Â·class("relative")
                    Â·child(
                    SearchÂ·view()
                        Â·class("absolute left-2 top-1/2 -translate-y-1/2 text-[#858585]")
                        Â·attr("size", 14)
                    )
                    Â·child(
                    InputÂ·view()
                        Â·class("h-7 pl-7 pr-7 text-xs bg-[#252526] border-[#3c3c3c]")
                        Â·attr("value", self.search_query)
                        Â·on_change(Change)
                        Â·attr("placeholder", "Search files...")
                    )
                    Â·when(self.search_query, VNodeÂ·button()
                        Â·class("absolute right-2 top-1/2 -translate-y-1/2 text-[#858585] hover:text-white")
                        Â·on_click(Click)
                        Â·child(
                        XCircleÂ·view()
                            Â·attr("size", 14)
                        ))
                ))
            Â·child(
            VNodeÂ·div()
                Â·class("px-3 py-2 border-b border-[#3c3c3c] flex flex-wrap gap-1.5")
                Â·child(
                ButtonÂ·view()
                    Â·attr("size", "sm")
                    Â·class("h-7 text-xs")
                    Â·on_click(Click)
                    Â·child(
                    PlusÂ·view()
                        Â·attr("size", 14)
                        Â·class("mr-1")
                    )
                    Â·text_child("Add Project")
                )
                Â·child(
                ButtonÂ·view()
                    Â·attr("size", "sm")
                    Â·attr("variant", "outline")
                    Â·class("h-7 text-xs")
                    Â·on_click(Click)
                    Â·when(self.loading, |n| nÂ·attr("disabled", "true"))
                    Â·text_child("Refresh")
                )
                Â·when(self.projects.len() > 0, VNodeÂ·fragment()
                    Â·child(
                    ButtonÂ·view()
                        Â·attr("size", "sm")
                        Â·attr("variant", "outline")
                        Â·class("h-7 text-xs")
                        Â·on_click(Click)
                        Â·text_child("Clear All")
                    )
                    Â·child(
                    ButtonÂ·view()
                        Â·attr("size", "sm")
                        Â·attr("variant", "outline")
                        Â·class("h-7 text-xs")
                        Â·on_click(Click)
                        Â·attr("title", "Expand file tree" )
                        Â·when_else(self.tree_collapsed, ChevronDownÂ·view()
                            Â·attr("size", 14)
                            Â·class("mr-1"), ChevronUpÂ·view()
                            Â·attr("size", 14)
                            Â·class("mr-1"))
                        Â·text_child("Expand Tree" Â·to_string())
                    ))
            )
            Â·when(self.error, VNodeÂ·div()
                Â·class("mx-2 my-2 p-3 bg-[#2b2b2b] border border-[#5a1d1d] rounded text-xs")
                Â·child(
                VNodeÂ·div()
                    Â·class("flex items-start gap-2")
                    Â·child(
                    XCircleÂ·view()
                        Â·attr("size", 14)
                        Â·class("text-[#f48771] flex-shrink-0 mt-0.5")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("flex-1")
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[#f48771] font-medium mb-1")
                            Â·text_child("Error")
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[#cccccc] mb-2")
                            Â·text_child(self.errorÂ·to_string())
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·class("flex gap-2")
                            Â·child(
                            ButtonÂ·view()
                                Â·attr("size", "sm")
                                Â·attr("variant", "outline")
                                Â·class("h-6 text-xs")
                                Â·on_click(Click)
                                Â·text_child("Retry")
                            )
                            Â·child(
                            ButtonÂ·view()
                                Â·attr("size", "sm")
                                Â·attr("variant", "ghost")
                                Â·class("h-6 text-xs")
                                Â·on_click(Click)
                                Â·text_child("Dismiss")
                            )
                        )
                    )
                ))
            Â·when(self.projects.len() > 0, VNodeÂ·div()
                Â·class("px-3 py-2 border-b border-[#3c3c3c] max-h-[200px] overflow-y-auto")
                Â·child(
                VNodeÂ·div()
                    Â·class("text-[11px] text-[#858585] font-semibold mb-1.5")
                    Â·text_child("PROJECTS (")
                    Â·text_child(self.projects.len()Â·to_string())
                    Â·text_child(")")
                )
                // Map: âˆ€ project âˆˆ projects
                Â·children(self.projects.iter().map(|project| VNodeÂ·div()
                        Â·attr("key", project.id)
                        Â·class("mb-1.5 p-2 bg-[#2b2b2b] border border-[#3c3c3c] rounded flex justify-between items-center cursor-pointer hover:bg-[#323232] hover:border-[#007acc]")
                        Â·child(
                        VNodeÂ·div()
                            Â·class("flex-1 min-w-0")
                            Â·child(
                            VNodeÂ·div()
                                Â·class("text-[13px] font-semibold text-[#cccccc] flex items-center gap-2")
                                Â·child(
                                VNodeÂ·span()
                                    Â·class("truncate")
                                    Â·attr("title", project.name)
                                    Â·text_child(project.nameÂ·to_string())
                                )
                                Â·child(
                                VNodeÂ·span()
                                    Â·class("text-[10px] px-1.5 py-0.5 rounded )
                                    Â·text_child(project."EXISTS" Â·to_string())
                                )
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·class("text-[11px] text-[#858585] truncate")
                                Â·attr("title", project.path)
                                Â·text_child(project.pathÂ·to_string())
                            )
                        )
                        Â·child(
                        ButtonÂ·view()
                            Â·attr("size", "sm")
                            Â·attr("variant", "ghost")
                            Â·class("h-6 w-6 p-0 ml-2 flex-shrink-0")
                            Â·on_click(Click)
                            Â·attr("title", "Remove from workspace")
                            Â·child(
                            Trash2Â·view()
                                Â·attr("size", 14)
                            )
                        )).collect()))
            Â·when_else(Â¬tree_collapsed, VNodeÂ·div()
                Â·class("flex-1 overflow-y-auto p-2")
                Â·when(self.projects.len() = 0, VNodeÂ·div()
                    Â·class("py-8 px-5 text-center text-[#858585] text-[13px]")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-4xl mb-4")
                        Â·child(
                        FolderÂ·view()
                            Â·class("w-12 h-12 mx-auto text-[#858585]")
                        )
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-2 font-semibold text-[#cccccc]")
                        Â·text_child("No projects yet")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[11px] text-[#858585] mb-4")
                        Â·text_child("Add a project directory to get started")
                    )
                    Â·child(
                    ButtonÂ·view()
                        Â·attr("size", "sm")
                        Â·on_click(Click)
                        Â·class("h-8")
                        Â·child(
                        PlusÂ·view()
                            Â·attr("size", 14)
                            Â·class("mr-1.5")
                        )
                        Â·text_child("Add Project")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#666] mt-4 space-y-1")
                        Â·child(
                        VNodeÂ·div()
                            Â·text_child("Quick tip: Enter the full path like")
                        )
                        Â·child(
                        VNodeÂ·code()
                            Â·class("px-1.5 py-0.5 bg-[#2b2b2b] rounded text-[#4fc3f7]")
                            Â·text_child("/home/user/my-project")
                        )
                    )), VNodeÂ·div()
                Â·class("flex-1 flex items-center justify-center text-center text-[#858585]")
                Â·child(
                VNodeÂ·div()
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-3xl mb-2")
                        Â·text_child("ğŸ“")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[11px]")
                        Â·text_child("File tree collapsed")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#666] mt-1")
                        Â·text_child("Click \"Expand Tree\" to view files")
                    )
                ))
            Â·child(
            DialogÂ·view()
                Â·attr("open", self.add_dialog_open)
                Â·on_openchange(OpenChange)
                Â·child(
                DialogContentÂ·view()
                    Â·class("max-w-[500px] bg-[#2b2b2b] border-[#3c3c3c]")
                    Â·child(
                    DialogHeaderÂ·view()
                        Â·child(
                        DialogTitleÂ·view()
                            Â·text_child("Add Project to Workspace")
                        )
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("flex flex-col gap-3 py-4")
                        Â·child(
                        VNodeÂ·div()
                            Â·child(
                            LabelÂ·view()
                                Â·class("text-xs text-[#cccccc] mb-1.5 block")
                                Â·text_child("Project Path")
                                Â·child(
                                VNodeÂ·span()
                                    Â·class("text-red-500")
                                    Â·text_child("*")
                                )
                            )
                            Â·child(
                            InputÂ·view()
                                Â·class("bg-[#1e1e1e] border-[#3c3c3c] text-[#cccccc]")
                                Â·attr("value", self.new_project_path)
                                Â·on_change(Change)
                                Â·attr("placeholder", "/home/user/my-project")
                                Â·when(self.adding, |n| nÂ·attr("disabled", "true"))
                                Â·attr("autoFocus", "true")
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·class("text-[11px] text-[#858585] mt-1")
                                Â·text_child("Enter the absolute path to the project directory")
                            )
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·child(
                            LabelÂ·view()
                                Â·class("text-xs text-[#cccccc] mb-1.5 block")
                                Â·text_child("Project Name (optional)")
                            )
                            Â·child(
                            InputÂ·view()
                                Â·class("bg-[#1e1e1e] border-[#3c3c3c] text-[#cccccc]")
                                Â·attr("value", self.new_project_name)
                                Â·on_change(Change)
                                Â·attr("placeholder", "My Project")
                                Â·when(self.adding, |n| nÂ·attr("disabled", "true"))
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·class("text-[11px] text-[#858585] mt-1")
                                Â·text_child("If not provided, will use directory name")
                            )
                        )
                        Â·when(self.add_error, VNodeÂ·div()
                            Â·class("p-2 bg-[#2b2b2b] text-[#f48771] rounded text-xs")
                            Â·text_child("âš ï¸")
                            Â·text_child(self.add_errorÂ·to_string()))
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[11px] text-[#007acc] p-2 bg-[#0e1f2b] rounded")
                            Â·child(
                            VNodeÂ·div()
                                Â·class("font-semibold mb-1")
                                Â·text_child("Examples:")
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·text_child("â€¢ /home/user/persona-framework")
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·text_child("â€¢ /tmp/my-project")
                            )
                            Â·child(
                            VNodeÂ·div()
                                Â·text_child("â€¢ /home/user/workspace/app")
                            )
                        )
                    )
                    Â·child(
                    DialogFooterÂ·view()
                        Â·child(
                        ButtonÂ·view()
                            Â·on_click(Click)
                            Â·when(adding âˆ¨ Â¬new_project_path.trim(), |n| nÂ·attr("disabled", "true"))
                            Â·text_child("Adding..." Â·to_string())
                        )
                        Â·child(
                        ButtonÂ·view()
                            Â·attr("variant", "outline")
                            Â·on_click(Click)
                            Â·when(self.adding, |n| nÂ·attr("disabled", "true"))
                            Â·text_child("Cancel")
                        )
                    )
                )
            )
            Â·child(
            ConfirmDialogÂ·view()
                Â·attr("open", self.remove_confirm_open)
                Â·on_openchange(OpenChange)
                Â·attr("title", "Remove Project")
                Â·attr("description", "Remove "" from workspace? This will not delete the project files.")
                Â·attr("confirmLabel", "Remove")
                Â·on_confirm(Confirm)
                Â·attr("variant", "destructive")
            )
            Â·child(
            ConfirmDialogÂ·view()
                Â·attr("open", self.clear_confirm_open)
                Â·on_openchange(OpenChange)
                Â·attr("title", "Clear Workspace")
                Â·attr("description", "Remove all projects from workspace? This will not delete any project files.")
                Â·attr("confirmLabel", "Clear All")
                Â·on_confirm(Confirm)
                Â·attr("variant", "destructive")
            )
    }
}