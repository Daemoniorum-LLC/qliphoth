invoke qliphothÂ·preludeÂ·*;
á›ˆ PerformanceMonitorPanelMsg {
    UpdateProfiling,
    UpdateMetrics,
    UpdateCpuHistory,
    UpdateMemoryHistory,
    UpdateHotspots,
}
actor PerformanceMonitorPanel {
    state profiling: bool! = False,
    state metrics: Option<Any>~ = âˆ…,
    state cpuHistory: Vec<Any>! = [],
    state memoryHistory: Vec<Any>! = [],
    state hotspots: Vec<Any>! = [],
    state canvasRef: Option<HTMLCanvasElement>! = âˆ…,

    on UpdateProfiling {
        self.profiling = msg.0;
    }

    on UpdateMetrics {
        self.metrics = msg.0;
    }

    on UpdateCpuHistory {
        self.cpuHistory = msg.0;
    }

    on UpdateMemoryHistory {
        self.memoryHistory = msg.0;
    }

    on UpdateHotspots {
        self.hotspots = msg.0;
    }

    rite view(self) -> VNode! {
        VNodeÂ·div()
            Â·class("flex flex-col h-full bg-[#1e1e1e] text-[#cccccc]")
            Â·child(
            VNodeÂ·div()
                Â·class("flex items-center justify-between px-3 py-2 border-b border-[#3c3c3c] bg-[#2b2b2b]")
                Â·child(
                VNodeÂ·div()
                    Â·class("text-[13px] font-semibold text-white")
                    Â·text_child("Performance Monitor")
                )
                Â·child(
                VNodeÂ·div()
                    Â·class("flex gap-1")
                    Â·when_else(Â¬profiling, ButtonÂ·view()
                        Â·attr("size", "sm")
                        Â·on_click(Click)
                        Â·child(
                        PlayÂ·view()
                            Â·class("w-3.5 h-3.5 mr-1")
                        )
                        Â·text_child("Start Profiling"), ButtonÂ·view()
                        Â·attr("size", "sm")
                        Â·on_click(Click)
                        Â·child(
                        SquareÂ·view()
                            Â·class("w-3.5 h-3.5 mr-1")
                        )
                        Â·text_child("Stop Profiling"))
                    Â·child(
                    ButtonÂ·view()
                        Â·attr("variant", "ghost")
                        Â·attr("size", "sm")
                        Â·on_click(Click)
                        Â·when(Â¬profiling âˆ§ cpu_history.len() == 0, |n| nÂ·attr("disabled", "True"))
                        Â·attr("title", "Export Profile")
                        Â·child(
                        DownloadÂ·view()
                            Â·class("w-3.5 h-3.5")
                        )
                    )
                )
            )
            Â·when(self.profiling, VNodeÂ·div()
                Â·class("grid grid-cols-2 gap-3 p-3 border-b border-[#3c3c3c]")
                Â·child(
                VNodeÂ·div()
                    Â·class("p-3 bg-[#252526] border border-[#3c3c3c] rounded")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#858585] uppercase mb-1.5")
                        Â·text_child("CPU Usage")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-2xl font-bold text-white mb-1")
                        Â·text_child(self.metrics.cpuÂ·to_string())
                        Â·text_child("%")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-2")
                        Â·child(
                        BadgeÂ·view()
                            Â·attr("variant", get_cpu_color(metrics.cpu))
                            Â·class("text-[10px]")
                            Â·text_child("Normal"Â·to_string())
                        )
                    )
                    Â·child(
                    ProgressÂ·view()
                        Â·attr("value", self.metrics.cpu)
                        Â·class("h-1.5")
                    )
                )
                Â·child(
                VNodeÂ·div()
                    Â·class("p-3 bg-[#252526] border border-[#3c3c3c] rounded")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#858585] uppercase mb-1.5")
                        Â·text_child("Memory")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-2xl font-bold text-white mb-1")
                        Â·text_child(self.metrics.memoryÂ·to_string())
                        Â·text_child("%")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-2")
                        Â·child(
                        BadgeÂ·view()
                            Â·attr("variant", get_memory_color(metrics.memory))
                            Â·class("text-[10px]")
                            Â·text_child("Normal"Â·to_string())
                        )
                    )
                    Â·child(
                    ProgressÂ·view()
                        Â·attr("value", self.metrics.memory)
                        Â·class("h-1.5")
                    )
                )
                Â·child(
                VNodeÂ·div()
                    Â·class("p-3 bg-[#252526] border border-[#3c3c3c] rounded")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#858585] uppercase mb-1.5")
                        Â·text_child("Frame Rate")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-2xl font-bold text-white")
                        Â·text_child(self.metrics.fpsÂ·to_string())
                        Â·text_child("FPS")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#b0b0b0] mt-1")
                        Â·text_child("âœ“ Smooth"Â·to_string())
                    )
                )
                Â·child(
                VNodeÂ·div()
                    Â·class("p-3 bg-[#252526] border border-[#3c3c3c] rounded")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#858585] uppercase mb-1.5")
                        Â·text_child("Network")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-2xl font-bold text-white")
                        Â·text_child(self.metrics.network_requestsÂ·to_string())
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-[10px] text-[#b0b0b0] mt-1")
                        Â·text_child("Active requests")
                    )
                ))
            Â·child(
            VNodeÂ·div()
                Â·class("flex-1 overflow-auto p-3")
                Â·when(Â¬profiling âˆ§ cpu_history.len() == 0, VNodeÂ·div()
                    Â·class("flex flex-col items-center justify-center h-full text-center text-[#858585] text-xs")
                    Â·child(
                    VNodeÂ·div()
                        Â·class("text-5xl mb-3")
                        Â·text_child("ðŸ“Š")
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·text_child("Click \"Start Profiling\" to begin monitoring performance")
                    ))
                Â·when(self.profiling, VNodeÂ·fragment()
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-5")
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[11px] font-semibold text-[#858585] uppercase mb-2")
                            Â·text_child("CPU Usage Over Time")
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·class("h-[120px] bg-[#252526] border border-[#3c3c3c] rounded p-2 relative")
                            Â·child(
                            VNodeÂ·canvas()
                                Â·attr("ref", self.canvas_ref)
                                Â·class("w-full h-full")
                            )
                        )
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-5")
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[11px] font-semibold text-[#858585] uppercase mb-2")
                            Â·text_child("Performance Hotspots")
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·class("flex flex-col gap-1")
                            // Map: âˆ€ hotspot âˆˆ hotspots
                            Â·children(self.hotspots.iter().map(|hotspot| VNodeÂ·div()
                                    Â·attr("key", self.index)
                                    Â·class("flex items-center justify-between px-3 py-2 bg-[#252526] border border-[#3c3c3c] rounded text-[11px]")
                                    Â·child(
                                    VNodeÂ·div()
                                        Â·class("flex-1")
                                        Â·child(
                                        VNodeÂ·div()
                                            Â·class("text-[#dcdcaa] font-medium")
                                            Â·text_child(hotspot.nameÂ·to_string())
                                        )
                                        Â·child(
                                        VNodeÂ·div()
                                            Â·class("text-[#858585] text-[10px]")
                                            Â·text_child(hotspot.fileÂ·to_string())
                                            Â·text_child(":")
                                            Â·text_child(hotspot.lineÂ·to_string())
                                        )
                                    )
                                    Â·child(
                                    VNodeÂ·div()
                                        Â·class("text-[#f48771] font-semibold ml-3")
                                        Â·text_child(hotspot.time.to_fixed(1)Â·to_string())
                                        Â·text_child("ms")
                                    )
                                    Â·child(
                                    VNodeÂ·div()
                                        Â·class("text-[#858585] text-[10px] ml-2")
                                        Â·text_child(hotspot.percentage.to_fixed(1)Â·to_string())
                                        Â·text_child("%")
                                    )).collect())
                        )
                    )
                    Â·child(
                    VNodeÂ·div()
                        Â·class("mb-5")
                        Â·child(
                        VNodeÂ·div()
                            Â·class("text-[11px] font-semibold text-[#858585] uppercase mb-2")
                            Â·text_child("Call Stack Flame Graph")
                        )
                        Â·child(
                        VNodeÂ·div()
                            Â·class("bg-[#252526] border border-[#3c3c3c] rounded p-3 min-h-[200px]")
                            // Map: âˆ€ hotspot âˆˆ hotspots
                            Â·children(self.hotspots.iter().map(|hotspot| VNodeÂ·div()
                                    Â·attr("key", self.index)
                                    Â·class("h-5 mb-0.5 flex items-center pl-2 text-[10px] text-white cursor-pointer rounded hover:opacity-80")
                                    Â·style(âˆ…)
                                    Â·text_child(hotspot.nameÂ·to_string())
                                    Â·text_child("(")
                                    Â·text_child(hotspot.time.to_fixed(1)Â·to_string())
                                    Â·text_child("ms)")).collect())
                        )
                    ))
            )
    }
}