{
  "id": "domains/chat/components/IntelliJStyleChat.tsx:IntelliJStyleChat",
  "name": "IntelliJStyleChat",
  "source": {
    "path": "/home/crook/dev/wraith/wraith-framework/src/domains/chat/components/IntelliJStyleChat.tsx",
    "code": "import React, { useRef, useState, useEffect } from 'react'\nimport { Button } from '@persona-framework/ui'\nimport { Textarea } from '@persona-framework/ui'\nimport { Loader2, Send, Plus, X, Copy, Edit, Check, Shield, Flame, FileText, Zap, AlertTriangle } from 'lucide-react'\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter'\nimport { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism'\nimport { makeHttpClient } from '../../../data/https'\n\nconst http = makeHttpClient('/api')\n\ninterface ChatMessage {\n  id: string\n  role: 'user' | 'assistant'\n  content: string\n  timestamp: number\n  taskId?: string\n  isError?: boolean\n  originalUserMessage?: string // For retry functionality\n}\n\ninterface ContextItem {\n  type: 'file' | 'folder' | 'selection'\n  name: string\n  path?: string\n  content?: string\n}\n\ninterface IntelliJStyleChatProps {\n  personaCode?: string\n  sprintContext?: any\n  onFileReference?: (path: string) => void\n}\n\nexport function IntelliJStyleChat({ personaCode = 'PAIMON', onFileReference }: IntelliJStyleChatProps) {\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [input, setInput] = useState('')\n  const [contextItems, setContextItems] = useState<ContextItem[]>([])\n  const [isGenerating, setIsGenerating] = useState(false)\n  const [conversationId, setConversationId] = useState<string | null>(null)\n  const [executionMode, setExecutionMode] = useState<'plan' | 'execute'>('execute')\n  const [strictMode, setStrictMode] = useState(false)\n  const [braveMode, setBraveMode] = useState(false)\n  const [editingMessageId, setEditingMessageId] = useState<string | null>(null)\n  const [editText, setEditText] = useState('')\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }, [messages])\n\n  const readFileContent = (file: File): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onload = (e) => resolve(e.target?.result as string)\n      reader.onerror = reject\n      reader.readAsText(file)\n    })\n  }\n\n  const handleAttachClick = () => {\n    fileInputRef.current?.click()\n  }\n\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files) return\n\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i]\n      try {\n        const content = await readFileContent(file)\n        setContextItems(prev => [...prev, {\n          type: 'file',\n          name: file.name,\n          content: content\n        }])\n      } catch {\n        // File read failed, skip this file\n      }\n    }\n\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }\n\n  const handleSend = async () => {\n    if (!input.trim() || isGenerating) return\n\n    const userMessage: ChatMessage = {\n      id: `msg-${Date.now()}`,\n      role: 'user',\n      content: input,\n      timestamp: Date.now(),\n    }\n\n    setMessages(prev => [...prev, userMessage])\n    setInput('')\n    setIsGenerating(true)\n\n    const assistantMessageId = `msg-${Date.now()}-assistant`\n    const assistantMessage: ChatMessage = {\n      id: assistantMessageId,\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n    }\n    setMessages(prev => [...prev, assistantMessage])\n\n    try {\n      const response = await http.post('/chat', {\n        message: input,\n        conversationId,\n        personaCode,\n        projectPath: '/home/user/development/projects/persona-framework',\n        executionMode,\n        strictMode,\n        braveMode,\n        openFiles: contextItems.filter(c => c.type === 'file').map(c => ({\n          path: c.path || c.name,\n          content: c.content,\n          language: 'text'\n        }))\n      })\n\n      const data = response.data\n\n      if (data.conversationId) {\n        setConversationId(data.conversationId)\n      }\n\n      setMessages(prev =>\n        prev.map(msg =>\n          msg.id === assistantMessageId\n            ? { ...msg, content: data.response || 'No response received', taskId: data.taskId }\n            : msg\n        )\n      )\n    } catch (error) {\n      setMessages(prev =>\n        prev.map(msg =>\n          msg.id === assistantMessageId\n            ? {\n                ...msg,\n                content: error instanceof Error ? error.message : 'Failed to send message',\n                isError: true,\n                originalUserMessage: input || userMessage.content\n              }\n            : msg\n        )\n      )\n    } finally {\n      setIsGenerating(false)\n    }\n  }\n\n  const handleEditMessage = (messageId: string, content: string) => {\n    setEditingMessageId(messageId)\n    setEditText(content)\n  }\n\n  const handleCancelEdit = () => {\n    setEditingMessageId(null)\n    setEditText('')\n  }\n\n  const handleRetry = (messageId: string, originalMessage: string) => {\n    // Remove the error message\n    setMessages(prev => prev.filter(msg => msg.id !== messageId))\n    // Set input and trigger send\n    setInput(originalMessage)\n    setTimeout(() => handleSend(), 100)\n  }\n\n  const handleSaveEdit = async () => {\n    if (!editingMessageId || !editText.trim()) return\n\n    const messageIndex = messages.findIndex(msg => msg.id === editingMessageId)\n    if (messageIndex === -1) return\n\n    const updatedMessage = { ...messages[messageIndex], content: editText }\n    const messagesToKeep = messages.slice(0, messageIndex)\n    setMessages([...messagesToKeep, updatedMessage])\n\n    setEditingMessageId(null)\n    setEditText('')\n\n    setInput(editText)\n    setTimeout(() => handleSend(), 100)\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  const parseCodeBlocks = (content: string) => {\n    const codeBlockRegex = /```(\\w+)?\\n([\\s\\S]*?)```/g\n    const parts: Array<{ type: 'text' | 'code'; content: string; language?: string }> = []\n    let lastIndex = 0\n    let match: RegExpExecArray | null\n\n    while ((match = codeBlockRegex.exec(content)) !== null) {\n      if (match.index > lastIndex) {\n        parts.push({\n          type: 'text',\n          content: content.substring(lastIndex, match.index),\n        })\n      }\n\n      parts.push({\n        type: 'code',\n        content: match[2].trim(),\n        language: match[1] || 'text',\n      })\n\n      lastIndex = match.index + match[0].length\n    }\n\n    if (lastIndex < content.length) {\n      parts.push({\n        type: 'text',\n        content: content.substring(lastIndex),\n      })\n    }\n\n    return parts.length > 0 ? parts : [{ type: 'text' as const, content }]\n  }\n\n  const removeContextItem = (index: number) => {\n    setContextItems(prev => prev.filter((_, i) => i !== index))\n  }\n\n  const copyCode = (code: string) => {\n    navigator.clipboard.writeText(code)\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-transparent\">\n      {contextItems.length > 0 && (\n        <div className=\"flex gap-1.5 p-2 border-t border-b border-[#3c3c3c] bg-[#252525] flex-wrap min-h-[40px]\">\n          {contextItems.map((item, idx) => (\n            <div key={idx} className=\"flex items-center gap-1 px-2 py-1 bg-[#3c3c3c] rounded-xl text-xs text-[#cccccc]\">\n              <span>{item.name}</span>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => removeContextItem(idx)}\n                className=\"min-w-0 p-0.5 h-auto\"\n              >\n                <X className=\"w-3 h-3\" />\n              </Button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      <div className=\"flex-1 overflow-y-auto p-3 flex flex-col gap-4 bg-transparent\">\n        {messages.length === 0 ? (\n          <div className=\"flex items-center justify-center h-full text-center p-6\">\n            <div className=\"max-w-md\">\n              <div className=\"text-lg font-semibold text-[#cccccc] mb-2\">AI Chat Assistant</div>\n              {personaCode && (\n                <div className=\"text-sm text-[#858585] mb-6\">Persona: {personaCode}</div>\n              )}\n\n              <div className=\"text-sm text-[#858585] mb-4\">Try one of these prompts:</div>\n\n              <div className=\"flex flex-col gap-2\">\n                {[\n                  'Explain how this codebase is structured',\n                  'Help me fix the failing tests',\n                  'Refactor this function to be more readable',\n                  'Add error handling to the API calls',\n                ].map((prompt, idx) => (\n                  <button\n                    key={idx}\n                    onClick={() => setInput(prompt)}\n                    className=\"text-left px-4 py-2.5 bg-[#2b2b2b] hover:bg-[#323232] border border-[#3c3c3c] hover:border-[#007acc] rounded-lg text-sm text-[#cccccc] transition-colors\"\n                  >\n                    {prompt}\n                  </button>\n                ))}\n              </div>\n\n              <div className=\"text-xs text-[#666] mt-6\">\n                Or type your own question below\n              </div>\n            </div>\n          </div>\n        ) : (\n          messages.map(msg => (\n            <div key={msg.id}>\n              {msg.role === 'user' ? (\n                <div className=\"self-end max-w-[80%] flex flex-col gap-1\">\n                  {editingMessageId === msg.id ? (\n                    <>\n                      <textarea\n                        className=\"w-full min-h-[60px] bg-[#1e1e1e] text-white border border-[#3c3c3c] rounded px-2 py-1.5 text-sm font-inherit resize-y\"\n                        value={editText}\n                        onChange={e => setEditText(e.target.value)}\n                        autoFocus\n                        onKeyDown={e => {\n                          if (e.key === 'Escape') handleCancelEdit()\n                          else if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) handleSaveEdit()\n                        }}\n                      />\n                      <div className=\"flex gap-1 justify-end mt-1\">\n                        <Button size=\"sm\" onClick={handleSaveEdit}>\n                          <Check className=\"w-3 h-3 mr-1\" />\n                          Save & Resend\n                        </Button>\n                        <Button variant=\"outline\" size=\"sm\" onClick={handleCancelEdit}>\n                          Cancel\n                        </Button>\n                      </div>\n                    </>\n                  ) : (\n                    <>\n                      <div className=\"self-end max-w-[80%] bg-[#264f78] text-white px-3.5 py-2.5 rounded-xl break-words whitespace-pre-wrap\">\n                        {msg.content}\n                        <div className=\"text-[11px] text-[#858585] mt-1\">\n                          {new Date(msg.timestamp).toLocaleTimeString()}\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleEditMessage(msg.id, msg.content)}\n                        className=\"self-end opacity-70\"\n                        title=\"Edit message\"\n                      >\n                        <Edit className=\"w-3 h-3 mr-1\" />\n                        Edit\n                      </Button>\n                    </>\n                  )}\n                </div>\n              ) : msg.isError ? (\n                // Error message with retry option\n                <div className=\"self-start max-w-[90%] p-3 bg-[#2b2b2b] border border-[#5a1d1d] rounded-lg\">\n                  <div className=\"flex items-start gap-2\">\n                    <AlertTriangle className=\"w-4 h-4 text-[#f48771] flex-shrink-0 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <div className=\"text-[#f48771] text-sm font-medium mb-1\">Failed to send message</div>\n                      <div className=\"text-[#cccccc] text-sm mb-3\">{msg.content}</div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => msg.originalUserMessage && handleRetry(msg.id, msg.originalUserMessage)}\n                          className=\"h-7 text-xs\"\n                        >\n                          Retry\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => setMessages(prev => prev.filter(m => m.id !== msg.id))}\n                          className=\"h-7 text-xs\"\n                        >\n                          Dismiss\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"self-start max-w-[90%] flex flex-col gap-2\">\n                  {parseCodeBlocks(msg.content).map((part, idx) =>\n                    part.type === 'text' ? (\n                      <div key={idx} className=\"text-[#cccccc] leading-relaxed whitespace-pre-wrap break-words\">\n                        {part.content}\n                      </div>\n                    ) : (\n                      <div key={idx} className=\"mt-2 mb-2 rounded-md overflow-hidden border border-[#3c3c3c]\">\n                        <div className=\"flex justify-between items-center px-3 py-1.5 bg-[#2d2d2d] border-b border-[#3c3c3c]\">\n                          <span className=\"text-xs text-[#858585]\">\n                            {part.language}\n                          </span>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => copyCode(part.content)}\n                              title=\"Copy\"\n                            >\n                              <Copy className=\"w-3 h-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                        <SyntaxHighlighter\n                          language={part.language}\n                          style={vscDarkPlus}\n                          customStyle={{\n                            margin: 0,\n                            fontSize: '13px',\n                            backgroundColor: '#1e1e1e',\n                          }}\n                        >\n                          {part.content}\n                        </SyntaxHighlighter>\n                      </div>\n                    )\n                  )}\n                  <div className=\"text-[11px] text-[#858585] mt-1\">\n                    {new Date(msg.timestamp).toLocaleTimeString()}\n                    {msg.taskId && <span className=\"ml-2 text-[#4ade80]\">Task: {msg.taskId.substring(0, 8)}</span>}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))\n        )}\n        {isGenerating && (\n          <div className=\"self-start max-w-[90%] flex flex-col gap-2\">\n            <div className=\"flex items-center gap-2\">\n              <Loader2 className=\"w-4 h-4 animate-spin\" />\n              <span className=\"text-sm\">Generating response...</span>\n            </div>\n          </div>\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      <div className=\"flex flex-col p-0 gap-0 border-t border-[#3c3c3c] bg-[#252525]\">\n        {/* Mode toggles toolbar */}\n        <div className=\"flex items-center gap-2 px-3 py-2 border-b border-[#3c3c3c] text-xs\">\n          <span className=\"text-[#858585] mr-1\">Mode:</span>\n\n          <button\n            onClick={() => setExecutionMode(executionMode === 'plan' ? 'execute' : 'plan')}\n            className={`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              executionMode === 'plan'\n                ? 'bg-[#1e3a5f] text-[#60a5fa] border border-[#3b82f6]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`}\n          >\n            {executionMode === 'plan' ? <FileText className=\"w-3 h-3\" /> : <Zap className=\"w-3 h-3\" />}\n            {executionMode === 'plan' ? 'Plan' : 'Execute'}\n          </button>\n\n          <button\n            onClick={() => setStrictMode(!strictMode)}\n            className={`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              strictMode\n                ? 'bg-[#3d2e0a] text-[#f59e0b] border border-[#f59e0b]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`}\n          >\n            <AlertTriangle className=\"w-3 h-3\" />\n            {strictMode ? 'Strict' : 'Flexible'}\n          </button>\n\n          <button\n            onClick={() => setBraveMode(!braveMode)}\n            className={`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              braveMode\n                ? 'bg-[#450a0a] text-[#f87171] border border-[#ef4444]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`}\n          >\n            {braveMode ? <Flame className=\"w-3 h-3\" /> : <Shield className=\"w-3 h-3\" />}\n            {braveMode ? 'Auto-approve' : 'Safe'}\n          </button>\n\n          {braveMode && (\n            <span className=\"text-[#f87171] text-[10px] ml-1\">\n              Risky commands will run without confirmation\n            </span>\n          )}\n        </div>\n\n        {/* Input area */}\n        <div className=\"relative w-full\">\n          <div className=\"absolute left-2 bottom-2 z-10\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleAttachClick}\n              title=\"Attach files\"\n              className=\"min-w-0 text-[#858585] hover:text-white\"\n            >\n              <Plus className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            onChange={handleFileChange}\n            className=\"hidden\"\n          />\n          <Textarea\n            ref={textareaRef}\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            onKeyDown={handleKeyDown}\n            placeholder=\"Enter to send â€¢ Shift+Enter for new line\"\n            className=\"w-full min-h-[90px] bg-[#1e1e1e] text-[#cccccc] border-none pl-9 pr-14 resize-none\"\n          />\n          <div className=\"absolute right-2 bottom-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleSend}\n              disabled={!input.trim() || isGenerating}\n              title=\"Send (Enter)\"\n              className={`min-w-0 ${input.trim() && !isGenerating ? 'text-[#4ade80] hover:text-[#86efac]' : 'text-[#858585]'}`}\n            >\n              <Send className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n",
    "extraction": {
      "name": "IntelliJStyleChat",
      "component_type": "functional",
      "exported": true,
      "export_type": "named",
      "location": {
        "start_line": 34,
        "start_col": 7,
        "end_line": 522,
        "end_col": 1
      },
      "props": [
        {
          "name": "personaCode",
          "type_annotation": null,
          "required": false,
          "default_value": "'PAIMON'",
          "is_callback": false,
          "is_children": false
        },
        {
          "name": "onFileReference",
          "type_annotation": null,
          "required": true,
          "default_value": null,
          "is_callback": true,
          "is_children": false
        }
      ],
      "props_type": null,
      "hooks": [
        {
          "hook_type": "useState",
          "location": {
            "start_line": 35,
            "start_col": 34,
            "end_line": 35,
            "end_col": 61
          },
          "state_name": "messages",
          "setter_name": "setMessages",
          "initial_value": "[]",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 36,
            "start_col": 28,
            "end_line": 36,
            "end_col": 40
          },
          "state_name": "input",
          "setter_name": "setInput",
          "initial_value": "\"\"",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 37,
            "start_col": 42,
            "end_line": 37,
            "end_col": 69
          },
          "state_name": "contextItems",
          "setter_name": "setContextItems",
          "initial_value": "[]",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 38,
            "start_col": 42,
            "end_line": 38,
            "end_col": 57
          },
          "state_name": "isGenerating",
          "setter_name": "setIsGenerating",
          "initial_value": "false",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 39,
            "start_col": 46,
            "end_line": 39,
            "end_col": 75
          },
          "state_name": "conversationId",
          "setter_name": "setConversationId",
          "initial_value": "null",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 40,
            "start_col": 44,
            "end_line": 40,
            "end_col": 83
          },
          "state_name": "executionMode",
          "setter_name": "setExecutionMode",
          "initial_value": "\"execute\"",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 41,
            "start_col": 38,
            "end_line": 41,
            "end_col": 53
          },
          "state_name": "strictMode",
          "setter_name": "setStrictMode",
          "initial_value": "false",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 42,
            "start_col": 36,
            "end_line": 42,
            "end_col": 51
          },
          "state_name": "braveMode",
          "setter_name": "setBraveMode",
          "initial_value": "false",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 43,
            "start_col": 50,
            "end_line": 43,
            "end_col": 79
          },
          "state_name": "editingMessageId",
          "setter_name": "setEditingMessageId",
          "initial_value": "null",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useState",
          "location": {
            "start_line": 44,
            "start_col": 34,
            "end_line": 44,
            "end_col": 46
          },
          "state_name": "editText",
          "setter_name": "setEditText",
          "initial_value": "\"\"",
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useRef",
          "location": {
            "start_line": 45,
            "start_col": 25,
            "end_line": 45,
            "end_col": 53
          },
          "state_name": null,
          "setter_name": null,
          "initial_value": null,
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": "messagesEndRef",
          "ref_type": "HTMLDivElement",
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useRef",
          "location": {
            "start_line": 46,
            "start_col": 22,
            "end_line": 46,
            "end_col": 55
          },
          "state_name": null,
          "setter_name": null,
          "initial_value": null,
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": "textareaRef",
          "ref_type": "HTMLTextAreaElement",
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useRef",
          "location": {
            "start_line": 47,
            "start_col": 23,
            "end_line": 47,
            "end_col": 53
          },
          "state_name": null,
          "setter_name": null,
          "initial_value": null,
          "dependencies": null,
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": "fileInputRef",
          "ref_type": "HTMLInputElement",
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        },
        {
          "hook_type": "useEffect",
          "location": {
            "start_line": 49,
            "start_col": 2,
            "end_line": 51,
            "end_col": 16
          },
          "state_name": null,
          "setter_name": null,
          "initial_value": null,
          "dependencies": [
            "messages"
          ],
          "has_cleanup": false,
          "memoized_deps": null,
          "ref_name": null,
          "ref_type": null,
          "context_name": null,
          "reducer_name": null,
          "action_types": []
        }
      ],
      "custom_hooks": [],
      "class_info": null,
      "jsx": {
        "root": {
          "node_type": {
            "type": "Element",
            "tag": "div",
            "is_component": false,
            "attributes": [
              {
                "name": "className",
                "value": {
                  "type": "String",
                  "value": "flex flex-col h-full bg-transparent"
                },
                "is_event_handler": false
              }
            ],
            "children": [
              {
                "node_type": {
                  "type": "Conditional",
                  "condition": "contextItems.length > 0",
                  "consequent": {
                    "node_type": {
                      "type": "Element",
                      "tag": "div",
                      "is_component": false,
                      "attributes": [
                        {
                          "name": "className",
                          "value": {
                            "type": "String",
                            "value": "flex gap-1.5 p-2 border-t border-b border-[#3c3c3c] bg-[#252525] flex-wrap min-h-[40px]"
                          },
                          "is_event_handler": false
                        }
                      ],
                      "children": [
                        {
                          "node_type": {
                            "type": "Map",
                            "iterable": "contextItems",
                            "item_name": "item",
                            "key_expr": "idx",
                            "body": {
                              "node_type": {
                                "type": "Element",
                                "tag": "div",
                                "is_component": false,
                                "attributes": [
                                  {
                                    "name": "key",
                                    "value": {
                                      "type": "Expression",
                                      "code": "idx"
                                    },
                                    "is_event_handler": false
                                  },
                                  {
                                    "name": "className",
                                    "value": {
                                      "type": "String",
                                      "value": "flex items-center gap-1 px-2 py-1 bg-[#3c3c3c] rounded-xl text-xs text-[#cccccc]"
                                    },
                                    "is_event_handler": false
                                  }
                                ],
                                "children": [
                                  {
                                    "node_type": {
                                      "type": "Element",
                                      "tag": "span",
                                      "is_component": false,
                                      "attributes": [],
                                      "children": [
                                        {
                                          "node_type": {
                                            "type": "Expression",
                                            "code": "item.name"
                                          },
                                          "location": {
                                            "start_line": 248,
                                            "start_col": 20,
                                            "end_line": 248,
                                            "end_col": 31
                                          }
                                        }
                                      ]
                                    },
                                    "location": {
                                      "start_line": 248,
                                      "start_col": 14,
                                      "end_line": 248,
                                      "end_col": 38
                                    }
                                  },
                                  {
                                    "node_type": {
                                      "type": "Element",
                                      "tag": "Button",
                                      "is_component": true,
                                      "attributes": [
                                        {
                                          "name": "variant",
                                          "value": {
                                            "type": "String",
                                            "value": "ghost"
                                          },
                                          "is_event_handler": false
                                        },
                                        {
                                          "name": "size",
                                          "value": {
                                            "type": "String",
                                            "value": "sm"
                                          },
                                          "is_event_handler": false
                                        },
                                        {
                                          "name": "onClick",
                                          "value": {
                                            "type": "Expression",
                                            "code": "() => removeContextItem(idx)"
                                          },
                                          "is_event_handler": true
                                        },
                                        {
                                          "name": "className",
                                          "value": {
                                            "type": "String",
                                            "value": "min-w-0 p-0.5 h-auto"
                                          },
                                          "is_event_handler": false
                                        }
                                      ],
                                      "children": [
                                        {
                                          "node_type": {
                                            "type": "Element",
                                            "tag": "X",
                                            "is_component": true,
                                            "attributes": [
                                              {
                                                "name": "className",
                                                "value": {
                                                  "type": "String",
                                                  "value": "w-3 h-3"
                                                },
                                                "is_event_handler": false
                                              }
                                            ],
                                            "children": []
                                          },
                                          "location": {
                                            "start_line": 255,
                                            "start_col": 16,
                                            "end_line": 255,
                                            "end_col": 41
                                          }
                                        }
                                      ]
                                    },
                                    "location": {
                                      "start_line": 249,
                                      "start_col": 14,
                                      "end_line": 256,
                                      "end_col": 23
                                    }
                                  }
                                ]
                              },
                              "location": {
                                "start_line": 247,
                                "start_col": 12,
                                "end_line": 257,
                                "end_col": 18
                              }
                            }
                          },
                          "location": {
                            "start_line": 246,
                            "start_col": 10,
                            "end_line": 258,
                            "end_col": 13
                          }
                        }
                      ]
                    },
                    "location": {
                      "start_line": 245,
                      "start_col": 8,
                      "end_line": 259,
                      "end_col": 14
                    }
                  },
                  "alternate": null
                },
                "location": {
                  "start_line": 244,
                  "start_col": 6,
                  "end_line": 260,
                  "end_col": 8
                }
              },
              {
                "node_type": {
                  "type": "Element",
                  "tag": "div",
                  "is_component": false,
                  "attributes": [
                    {
                      "name": "className",
                      "value": {
                        "type": "String",
                        "value": "flex-1 overflow-y-auto p-3 flex flex-col gap-4 bg-transparent"
                      },
                      "is_event_handler": false
                    }
                  ],
                  "children": [
                    {
                      "node_type": {
                        "type": "Conditional",
                        "condition": "messages.length === 0",
                        "consequent": {
                          "node_type": {
                            "type": "Element",
                            "tag": "div",
                            "is_component": false,
                            "attributes": [
                              {
                                "name": "className",
                                "value": {
                                  "type": "String",
                                  "value": "flex items-center justify-center h-full text-center p-6"
                                },
                                "is_event_handler": false
                              }
                            ],
                            "children": [
                              {
                                "node_type": {
                                  "type": "Element",
                                  "tag": "div",
                                  "is_component": false,
                                  "attributes": [
                                    {
                                      "name": "className",
                                      "value": {
                                        "type": "String",
                                        "value": "max-w-md"
                                      },
                                      "is_event_handler": false
                                    }
                                  ],
                                  "children": [
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "div",
                                        "is_component": false,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "text-lg font-semibold text-[#cccccc] mb-2"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": [
                                          {
                                            "node_type": {
                                              "type": "Text",
                                              "value": "AI Chat Assistant"
                                            },
                                            "location": {
                                              "start_line": 266,
                                              "start_col": 73,
                                              "end_line": 266,
                                              "end_col": 90
                                            }
                                          }
                                        ]
                                      },
                                      "location": {
                                        "start_line": 266,
                                        "start_col": 14,
                                        "end_line": 266,
                                        "end_col": 96
                                      }
                                    },
                                    {
                                      "node_type": {
                                        "type": "Conditional",
                                        "condition": "personaCode",
                                        "consequent": {
                                          "node_type": {
                                            "type": "Element",
                                            "tag": "div",
                                            "is_component": false,
                                            "attributes": [
                                              {
                                                "name": "className",
                                                "value": {
                                                  "type": "String",
                                                  "value": "text-sm text-[#858585] mb-6"
                                                },
                                                "is_event_handler": false
                                              }
                                            ],
                                            "children": [
                                              {
                                                "node_type": {
                                                  "type": "Text",
                                                  "value": "Persona:"
                                                },
                                                "location": {
                                                  "start_line": 268,
                                                  "start_col": 61,
                                                  "end_line": 268,
                                                  "end_col": 70
                                                }
                                              },
                                              {
                                                "node_type": {
                                                  "type": "Expression",
                                                  "code": "personaCode"
                                                },
                                                "location": {
                                                  "start_line": 268,
                                                  "start_col": 70,
                                                  "end_line": 268,
                                                  "end_col": 83
                                                }
                                              }
                                            ]
                                          },
                                          "location": {
                                            "start_line": 268,
                                            "start_col": 16,
                                            "end_line": 268,
                                            "end_col": 89
                                          }
                                        },
                                        "alternate": null
                                      },
                                      "location": {
                                        "start_line": 267,
                                        "start_col": 14,
                                        "end_line": 269,
                                        "end_col": 16
                                      }
                                    },
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "div",
                                        "is_component": false,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "text-sm text-[#858585] mb-4"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": [
                                          {
                                            "node_type": {
                                              "type": "Text",
                                              "value": "Try one of these prompts:"
                                            },
                                            "location": {
                                              "start_line": 271,
                                              "start_col": 59,
                                              "end_line": 271,
                                              "end_col": 84
                                            }
                                          }
                                        ]
                                      },
                                      "location": {
                                        "start_line": 271,
                                        "start_col": 14,
                                        "end_line": 271,
                                        "end_col": 90
                                      }
                                    },
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "div",
                                        "is_component": false,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "flex flex-col gap-2"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": [
                                          {
                                            "node_type": {
                                              "type": "Map",
                                              "iterable": "[\n                  'Explain how this codebase is structured',\n                  'Help me fix the failing tests',\n                  'Refactor this function to be more readable',\n                  'Add error handling to the API calls',\n                ]",
                                              "item_name": "prompt",
                                              "key_expr": "idx",
                                              "body": {
                                                "node_type": {
                                                  "type": "Element",
                                                  "tag": "button",
                                                  "is_component": false,
                                                  "attributes": [
                                                    {
                                                      "name": "key",
                                                      "value": {
                                                        "type": "Expression",
                                                        "code": "idx"
                                                      },
                                                      "is_event_handler": false
                                                    },
                                                    {
                                                      "name": "onClick",
                                                      "value": {
                                                        "type": "Expression",
                                                        "code": "() => setInput(prompt)"
                                                      },
                                                      "is_event_handler": true
                                                    },
                                                    {
                                                      "name": "className",
                                                      "value": {
                                                        "type": "String",
                                                        "value": "text-left px-4 py-2.5 bg-[#2b2b2b] hover:bg-[#323232] border border-[#3c3c3c] hover:border-[#007acc] rounded-lg text-sm text-[#cccccc] transition-colors"
                                                      },
                                                      "is_event_handler": false
                                                    }
                                                  ],
                                                  "children": [
                                                    {
                                                      "node_type": {
                                                        "type": "Expression",
                                                        "code": "prompt"
                                                      },
                                                      "location": {
                                                        "start_line": 285,
                                                        "start_col": 20,
                                                        "end_line": 285,
                                                        "end_col": 28
                                                      }
                                                    }
                                                  ]
                                                },
                                                "location": {
                                                  "start_line": 280,
                                                  "start_col": 18,
                                                  "end_line": 286,
                                                  "end_col": 27
                                                }
                                              }
                                            },
                                            "location": {
                                              "start_line": 274,
                                              "start_col": 16,
                                              "end_line": 287,
                                              "end_col": 19
                                            }
                                          }
                                        ]
                                      },
                                      "location": {
                                        "start_line": 273,
                                        "start_col": 14,
                                        "end_line": 288,
                                        "end_col": 20
                                      }
                                    },
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "div",
                                        "is_component": false,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "text-xs text-[#666] mt-6"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": [
                                          {
                                            "node_type": {
                                              "type": "Text",
                                              "value": "Or type your own question below"
                                            },
                                            "location": {
                                              "start_line": 290,
                                              "start_col": 56,
                                              "end_line": 292,
                                              "end_col": 14
                                            }
                                          }
                                        ]
                                      },
                                      "location": {
                                        "start_line": 290,
                                        "start_col": 14,
                                        "end_line": 292,
                                        "end_col": 20
                                      }
                                    }
                                  ]
                                },
                                "location": {
                                  "start_line": 265,
                                  "start_col": 12,
                                  "end_line": 293,
                                  "end_col": 18
                                }
                              }
                            ]
                          },
                          "location": {
                            "start_line": 264,
                            "start_col": 10,
                            "end_line": 294,
                            "end_col": 16
                          }
                        },
                        "alternate": null
                      },
                      "location": {
                        "start_line": 263,
                        "start_col": 8,
                        "end_line": 418,
                        "end_col": 10
                      }
                    },
                    {
                      "node_type": {
                        "type": "Conditional",
                        "condition": "isGenerating",
                        "consequent": {
                          "node_type": {
                            "type": "Element",
                            "tag": "div",
                            "is_component": false,
                            "attributes": [
                              {
                                "name": "className",
                                "value": {
                                  "type": "String",
                                  "value": "self-start max-w-[90%] flex flex-col gap-2"
                                },
                                "is_event_handler": false
                              }
                            ],
                            "children": [
                              {
                                "node_type": {
                                  "type": "Element",
                                  "tag": "div",
                                  "is_component": false,
                                  "attributes": [
                                    {
                                      "name": "className",
                                      "value": {
                                        "type": "String",
                                        "value": "flex items-center gap-2"
                                      },
                                      "is_event_handler": false
                                    }
                                  ],
                                  "children": [
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "Loader2",
                                        "is_component": true,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "w-4 h-4 animate-spin"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": []
                                      },
                                      "location": {
                                        "start_line": 422,
                                        "start_col": 14,
                                        "end_line": 422,
                                        "end_col": 58
                                      }
                                    },
                                    {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "span",
                                        "is_component": false,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "text-sm"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": [
                                          {
                                            "node_type": {
                                              "type": "Text",
                                              "value": "Generating response..."
                                            },
                                            "location": {
                                              "start_line": 423,
                                              "start_col": 40,
                                              "end_line": 423,
                                              "end_col": 62
                                            }
                                          }
                                        ]
                                      },
                                      "location": {
                                        "start_line": 423,
                                        "start_col": 14,
                                        "end_line": 423,
                                        "end_col": 69
                                      }
                                    }
                                  ]
                                },
                                "location": {
                                  "start_line": 421,
                                  "start_col": 12,
                                  "end_line": 424,
                                  "end_col": 18
                                }
                              }
                            ]
                          },
                          "location": {
                            "start_line": 420,
                            "start_col": 10,
                            "end_line": 425,
                            "end_col": 16
                          }
                        },
                        "alternate": null
                      },
                      "location": {
                        "start_line": 419,
                        "start_col": 8,
                        "end_line": 426,
                        "end_col": 10
                      }
                    },
                    {
                      "node_type": {
                        "type": "Element",
                        "tag": "div",
                        "is_component": false,
                        "attributes": [
                          {
                            "name": "ref",
                            "value": {
                              "type": "Expression",
                              "code": "messagesEndRef"
                            },
                            "is_event_handler": false
                          }
                        ],
                        "children": []
                      },
                      "location": {
                        "start_line": 427,
                        "start_col": 8,
                        "end_line": 427,
                        "end_col": 36
                      }
                    }
                  ]
                },
                "location": {
                  "start_line": 262,
                  "start_col": 6,
                  "end_line": 428,
                  "end_col": 12
                }
              },
              {
                "node_type": {
                  "type": "Element",
                  "tag": "div",
                  "is_component": false,
                  "attributes": [
                    {
                      "name": "className",
                      "value": {
                        "type": "String",
                        "value": "flex flex-col p-0 gap-0 border-t border-[#3c3c3c] bg-[#252525]"
                      },
                      "is_event_handler": false
                    }
                  ],
                  "children": [
                    {
                      "node_type": {
                        "type": "Element",
                        "tag": "div",
                        "is_component": false,
                        "attributes": [
                          {
                            "name": "className",
                            "value": {
                              "type": "String",
                              "value": "flex items-center gap-2 px-3 py-2 border-b border-[#3c3c3c] text-xs"
                            },
                            "is_event_handler": false
                          }
                        ],
                        "children": [
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "span",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "String",
                                    "value": "text-[#858585] mr-1"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Text",
                                    "value": "Mode:"
                                  },
                                  "location": {
                                    "start_line": 433,
                                    "start_col": 48,
                                    "end_line": 433,
                                    "end_col": 53
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 433,
                              "start_col": 10,
                              "end_line": 433,
                              "end_col": 60
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "button",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "onClick",
                                  "value": {
                                    "type": "Expression",
                                    "code": "() => setExecutionMode(executionMode === 'plan' ? 'execute' : 'plan')"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "Expression",
                                    "code": "`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              executionMode === 'plan'\n                ? 'bg-[#1e3a5f] text-[#60a5fa] border border-[#3b82f6]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Conditional",
                                    "condition": "executionMode === 'plan'",
                                    "consequent": {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "FileText",
                                        "is_component": true,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "w-3 h-3"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": []
                                      },
                                      "location": {
                                        "start_line": 443,
                                        "start_col": 40,
                                        "end_line": 443,
                                        "end_col": 72
                                      }
                                    },
                                    "alternate": {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "Zap",
                                        "is_component": true,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "w-3 h-3"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": []
                                      },
                                      "location": {
                                        "start_line": 443,
                                        "start_col": 75,
                                        "end_line": 443,
                                        "end_col": 102
                                      }
                                    }
                                  },
                                  "location": {
                                    "start_line": 443,
                                    "start_col": 12,
                                    "end_line": 443,
                                    "end_col": 103
                                  }
                                },
                                {
                                  "node_type": {
                                    "type": "Expression",
                                    "code": "executionMode === 'plan' ? 'Plan' : 'Execute'"
                                  },
                                  "location": {
                                    "start_line": 444,
                                    "start_col": 12,
                                    "end_line": 444,
                                    "end_col": 59
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 435,
                              "start_col": 10,
                              "end_line": 445,
                              "end_col": 19
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "button",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "onClick",
                                  "value": {
                                    "type": "Expression",
                                    "code": "() => setStrictMode(!strictMode)"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "Expression",
                                    "code": "`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              strictMode\n                ? 'bg-[#3d2e0a] text-[#f59e0b] border border-[#f59e0b]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Element",
                                    "tag": "AlertTriangle",
                                    "is_component": true,
                                    "attributes": [
                                      {
                                        "name": "className",
                                        "value": {
                                          "type": "String",
                                          "value": "w-3 h-3"
                                        },
                                        "is_event_handler": false
                                      }
                                    ],
                                    "children": []
                                  },
                                  "location": {
                                    "start_line": 455,
                                    "start_col": 12,
                                    "end_line": 455,
                                    "end_col": 49
                                  }
                                },
                                {
                                  "node_type": {
                                    "type": "Expression",
                                    "code": "strictMode ? 'Strict' : 'Flexible'"
                                  },
                                  "location": {
                                    "start_line": 456,
                                    "start_col": 12,
                                    "end_line": 456,
                                    "end_col": 48
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 447,
                              "start_col": 10,
                              "end_line": 457,
                              "end_col": 19
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "button",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "onClick",
                                  "value": {
                                    "type": "Expression",
                                    "code": "() => setBraveMode(!braveMode)"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "Expression",
                                    "code": "`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${\n              braveMode\n                ? 'bg-[#450a0a] text-[#f87171] border border-[#ef4444]'\n                : 'bg-[#2b2b2b] text-[#858585] border border-[#3c3c3c] hover:border-[#525252]'\n            }`"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Conditional",
                                    "condition": "braveMode",
                                    "consequent": {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "Flame",
                                        "is_component": true,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "w-3 h-3"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": []
                                      },
                                      "location": {
                                        "start_line": 467,
                                        "start_col": 25,
                                        "end_line": 467,
                                        "end_col": 54
                                      }
                                    },
                                    "alternate": {
                                      "node_type": {
                                        "type": "Element",
                                        "tag": "Shield",
                                        "is_component": true,
                                        "attributes": [
                                          {
                                            "name": "className",
                                            "value": {
                                              "type": "String",
                                              "value": "w-3 h-3"
                                            },
                                            "is_event_handler": false
                                          }
                                        ],
                                        "children": []
                                      },
                                      "location": {
                                        "start_line": 467,
                                        "start_col": 57,
                                        "end_line": 467,
                                        "end_col": 87
                                      }
                                    }
                                  },
                                  "location": {
                                    "start_line": 467,
                                    "start_col": 12,
                                    "end_line": 467,
                                    "end_col": 88
                                  }
                                },
                                {
                                  "node_type": {
                                    "type": "Expression",
                                    "code": "braveMode ? 'Auto-approve' : 'Safe'"
                                  },
                                  "location": {
                                    "start_line": 468,
                                    "start_col": 12,
                                    "end_line": 468,
                                    "end_col": 49
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 459,
                              "start_col": 10,
                              "end_line": 469,
                              "end_col": 19
                            }
                          },
                          {
                            "node_type": {
                              "type": "Conditional",
                              "condition": "braveMode",
                              "consequent": {
                                "node_type": {
                                  "type": "Element",
                                  "tag": "span",
                                  "is_component": false,
                                  "attributes": [
                                    {
                                      "name": "className",
                                      "value": {
                                        "type": "String",
                                        "value": "text-[#f87171] text-[10px] ml-1"
                                      },
                                      "is_event_handler": false
                                    }
                                  ],
                                  "children": [
                                    {
                                      "node_type": {
                                        "type": "Text",
                                        "value": "Risky commands will run without confirmation"
                                      },
                                      "location": {
                                        "start_line": 472,
                                        "start_col": 62,
                                        "end_line": 474,
                                        "end_col": 12
                                      }
                                    }
                                  ]
                                },
                                "location": {
                                  "start_line": 472,
                                  "start_col": 12,
                                  "end_line": 474,
                                  "end_col": 19
                                }
                              },
                              "alternate": null
                            },
                            "location": {
                              "start_line": 471,
                              "start_col": 10,
                              "end_line": 475,
                              "end_col": 12
                            }
                          }
                        ]
                      },
                      "location": {
                        "start_line": 432,
                        "start_col": 8,
                        "end_line": 476,
                        "end_col": 14
                      }
                    },
                    {
                      "node_type": {
                        "type": "Element",
                        "tag": "div",
                        "is_component": false,
                        "attributes": [
                          {
                            "name": "className",
                            "value": {
                              "type": "String",
                              "value": "relative w-full"
                            },
                            "is_event_handler": false
                          }
                        ],
                        "children": [
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "div",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "String",
                                    "value": "absolute left-2 bottom-2 z-10"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Element",
                                    "tag": "Button",
                                    "is_component": true,
                                    "attributes": [
                                      {
                                        "name": "variant",
                                        "value": {
                                          "type": "String",
                                          "value": "ghost"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "size",
                                        "value": {
                                          "type": "String",
                                          "value": "sm"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "onClick",
                                        "value": {
                                          "type": "Expression",
                                          "code": "handleAttachClick"
                                        },
                                        "is_event_handler": true
                                      },
                                      {
                                        "name": "title",
                                        "value": {
                                          "type": "String",
                                          "value": "Attach files"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "className",
                                        "value": {
                                          "type": "String",
                                          "value": "min-w-0 text-[#858585] hover:text-white"
                                        },
                                        "is_event_handler": false
                                      }
                                    ],
                                    "children": [
                                      {
                                        "node_type": {
                                          "type": "Element",
                                          "tag": "Plus",
                                          "is_component": true,
                                          "attributes": [
                                            {
                                              "name": "className",
                                              "value": {
                                                "type": "String",
                                                "value": "w-4 h-4"
                                              },
                                              "is_event_handler": false
                                            }
                                          ],
                                          "children": []
                                        },
                                        "location": {
                                          "start_line": 488,
                                          "start_col": 14,
                                          "end_line": 488,
                                          "end_col": 42
                                        }
                                      }
                                    ]
                                  },
                                  "location": {
                                    "start_line": 481,
                                    "start_col": 12,
                                    "end_line": 489,
                                    "end_col": 21
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 480,
                              "start_col": 10,
                              "end_line": 490,
                              "end_col": 16
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "input",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "ref",
                                  "value": {
                                    "type": "Expression",
                                    "code": "fileInputRef"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "type",
                                  "value": {
                                    "type": "String",
                                    "value": "file"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "multiple",
                                  "value": {
                                    "type": "True"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "onChange",
                                  "value": {
                                    "type": "Expression",
                                    "code": "handleFileChange"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "String",
                                    "value": "hidden"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": []
                            },
                            "location": {
                              "start_line": 491,
                              "start_col": 10,
                              "end_line": 497,
                              "end_col": 12
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "Textarea",
                              "is_component": true,
                              "attributes": [
                                {
                                  "name": "ref",
                                  "value": {
                                    "type": "Expression",
                                    "code": "textareaRef"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "value",
                                  "value": {
                                    "type": "Expression",
                                    "code": "input"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "onChange",
                                  "value": {
                                    "type": "Expression",
                                    "code": "(e) => setInput(e.target.value)"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "onKeyDown",
                                  "value": {
                                    "type": "Expression",
                                    "code": "handleKeyDown"
                                  },
                                  "is_event_handler": true
                                },
                                {
                                  "name": "placeholder",
                                  "value": {
                                    "type": "String",
                                    "value": "Enter to send â€¢ Shift+Enter for new line"
                                  },
                                  "is_event_handler": false
                                },
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "String",
                                    "value": "w-full min-h-[90px] bg-[#1e1e1e] text-[#cccccc] border-none pl-9 pr-14 resize-none"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": []
                            },
                            "location": {
                              "start_line": 498,
                              "start_col": 10,
                              "end_line": 505,
                              "end_col": 12
                            }
                          },
                          {
                            "node_type": {
                              "type": "Element",
                              "tag": "div",
                              "is_component": false,
                              "attributes": [
                                {
                                  "name": "className",
                                  "value": {
                                    "type": "String",
                                    "value": "absolute right-2 bottom-2"
                                  },
                                  "is_event_handler": false
                                }
                              ],
                              "children": [
                                {
                                  "node_type": {
                                    "type": "Element",
                                    "tag": "Button",
                                    "is_component": true,
                                    "attributes": [
                                      {
                                        "name": "variant",
                                        "value": {
                                          "type": "String",
                                          "value": "ghost"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "size",
                                        "value": {
                                          "type": "String",
                                          "value": "sm"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "onClick",
                                        "value": {
                                          "type": "Expression",
                                          "code": "handleSend"
                                        },
                                        "is_event_handler": true
                                      },
                                      {
                                        "name": "disabled",
                                        "value": {
                                          "type": "Expression",
                                          "code": "!input.trim() || isGenerating"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "title",
                                        "value": {
                                          "type": "String",
                                          "value": "Send (Enter)"
                                        },
                                        "is_event_handler": false
                                      },
                                      {
                                        "name": "className",
                                        "value": {
                                          "type": "Expression",
                                          "code": "`min-w-0 ${input.trim() && !isGenerating ? 'text-[#4ade80] hover:text-[#86efac]' : 'text-[#858585]'}`"
                                        },
                                        "is_event_handler": false
                                      }
                                    ],
                                    "children": [
                                      {
                                        "node_type": {
                                          "type": "Element",
                                          "tag": "Send",
                                          "is_component": true,
                                          "attributes": [
                                            {
                                              "name": "className",
                                              "value": {
                                                "type": "String",
                                                "value": "w-4 h-4"
                                              },
                                              "is_event_handler": false
                                            }
                                          ],
                                          "children": []
                                        },
                                        "location": {
                                          "start_line": 515,
                                          "start_col": 14,
                                          "end_line": 515,
                                          "end_col": 42
                                        }
                                      }
                                    ]
                                  },
                                  "location": {
                                    "start_line": 507,
                                    "start_col": 12,
                                    "end_line": 516,
                                    "end_col": 21
                                  }
                                }
                              ]
                            },
                            "location": {
                              "start_line": 506,
                              "start_col": 10,
                              "end_line": 517,
                              "end_col": 16
                            }
                          }
                        ]
                      },
                      "location": {
                        "start_line": 479,
                        "start_col": 8,
                        "end_line": 518,
                        "end_col": 14
                      }
                    }
                  ]
                },
                "location": {
                  "start_line": 430,
                  "start_col": 6,
                  "end_line": 519,
                  "end_col": 12
                }
              }
            ]
          },
          "location": {
            "start_line": 243,
            "start_col": 4,
            "end_line": 520,
            "end_col": 10
          }
        }
      },
      "handlers": [
        {
          "name": "handleAttachClick",
          "event_type": null,
          "is_async": false,
          "body_summary": "() => {\n    fileInputRef.current?.click()\n  }",
          "state_mutations": [],
          "api_calls": [],
          "calls": [],
          "side_effects": [],
          "parameters": [],
          "has_conditionals": false,
          "has_early_return": false
        },
        {
          "name": "handleFileChange",
          "event_type": null,
          "is_async": true,
          "body_summary": "async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files) return\n\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i]\n      try {\n        const content = await readFileContent(file)\n        setContextItems(prev => [...prev, {\n          type: 'file',\n          name: file.name,\n          content: content\n        }])\n      } catch {\n        // File read failed, skip this file\n      }\n    }\n\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }",
          "state_mutations": [],
          "api_calls": [],
          "calls": [],
          "side_effects": [],
          "parameters": [
            {
              "name": "e",
              "type_annotation": ": React.ChangeEvent<HTMLInputElement>"
            }
          ],
          "has_conditionals": true,
          "has_early_return": false
        },
        {
          "name": "handleSend",
          "event_type": null,
          "is_async": true,
          "body_summary": "async () => {\n    if (!input.trim() || isGenerating) return\n\n    const userMessage: ChatMessage = {\n      id: `msg-${Date.now()}`,\n      role: 'user',\n      content: input,\n      timestamp: Date.now(),\n    }\n\n    setMessages(prev => [...prev, userMessage])\n    setInput('')\n    setIsGenerating(true)\n\n    const assistantMessageId = `msg-${Date.now()}-assistant`\n    const assistantMessage: ChatMessage = {\n      id: assistantMessageId,\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n    }\n    setMessages(prev => [...prev, assistantMessage])\n\n    try {\n      const response = await http.post('/chat', {\n        message: input,\n        conversationId,\n        personaCode,\n        projectPath: '/home/user/development/projects/persona-framework',\n        executionMode,\n        strictMode,\n        braveMode,\n        openFiles: contextItems.filter(c => c.type === 'file').map(c => ({\n          path: c.path || c.name,\n          content: c.content,\n          language: 'text'\n        }))\n      })\n\n      const data = response.data\n\n      if (data.conversationId) {\n        setConversationId(data.conversationId)\n      }\n\n      setMessages(prev =>\n        prev.map(msg =>\n          msg.id === assistantMessageId\n            ? { ...msg, content: data.response || 'No response received', taskId: data.taskId }\n            : msg\n        )\n      )\n    } catch (error) {\n      setMessages(prev =>\n        prev.map(msg =>\n          msg.id === assistantMessageId\n            ? {\n                ...msg,\n                content: error instanceof Error ? error.message : 'Failed to send message',\n                isError: true,\n                originalUserMessage: input || userMessage.content\n              }\n            : msg\n        )\n      )\n    } finally {\n      setIsGenerating(false)\n    }\n  }",
          "state_mutations": [
            "setMessages(prev => [...prev, userMessage])",
            "setInput('')",
            "setIsGenerating(true)",
            "setMessages(prev => [...prev, assistantMessage])"
          ],
          "api_calls": [],
          "calls": [
            {
              "name": "setMessages",
              "source": {
                "type": "StateSetter",
                "state_name": "messages"
              },
              "arguments": [
                "prev => [...prev, userMessage]"
              ],
              "is_async": false
            },
            {
              "name": "setInput",
              "source": {
                "type": "StateSetter",
                "state_name": "input"
              },
              "arguments": [
                "''"
              ],
              "is_async": false
            },
            {
              "name": "setIsGenerating",
              "source": {
                "type": "StateSetter",
                "state_name": "isGenerating"
              },
              "arguments": [
                "true"
              ],
              "is_async": false
            },
            {
              "name": "setMessages",
              "source": {
                "type": "StateSetter",
                "state_name": "messages"
              },
              "arguments": [
                "prev => [...prev, assistantMessage]"
              ],
              "is_async": false
            },
            {
              "name": "http.post",
              "source": {
                "type": "Unknown"
              },
              "arguments": [
                "'/chat'",
                "{\n        message: input,\n        conversationId,\n        personaCode,\n        projectPath: '/home/user/development/projects/persona-framework',\n        executionMode,\n        strictMode,\n        braveMode,\n        openFiles: contextItems.filter(c => c.type === 'file').map(c => ({\n          path: c.path || c.name,\n          content: c.content,\n          language: 'text'\n        }))\n      }"
              ],
              "is_async": true
            },
            {
              "name": "setConversationId",
              "source": {
                "type": "StateSetter",
                "state_name": "conversationId"
              },
              "arguments": [
                "data.conversationId"
              ],
              "is_async": false
            },
            {
              "name": "setMessages",
              "source": {
                "type": "StateSetter",
                "state_name": "messages"
              },
              "arguments": [
                "prev =>\n        prev.map(msg =>\n          msg.id === assistantMessageId\n            ? { ...msg, content: data.response || 'No response received', taskId: data.taskId }\n            : msg\n        )"
              ],
              "is_async": false
            },
            {
              "name": "prev.map",
              "source": {
                "type": "Unknown"
              },
              "arguments": [
                "msg =>\n          msg.id === assistantMessageId\n            ? { ...msg, content: data.response || 'No response received', taskId: data.taskId }\n            : msg"
              ],
              "is_async": false
            }
          ],
          "side_effects": [
            {
              "kind": "StateMutation",
              "target": "setMessages"
            },
            {
              "kind": "StateMutation",
              "target": "setInput"
            },
            {
              "kind": "StateMutation",
              "target": "setIsGenerating"
            },
            {
              "kind": "StateMutation",
              "target": "setMessages"
            },
            {
              "kind": "StateMutation",
              "target": "setConversationId"
            },
            {
              "kind": "StateMutation",
              "target": "setMessages"
            }
          ],
          "parameters": [],
          "has_conditionals": true,
          "has_early_return": false
        },
        {
          "name": "handleEditMessage",
          "event_type": null,
          "is_async": false,
          "body_summary": "(messageId: string, content: string) => {\n    setEditingMessageId(messageId)\n    setEditText(content)\n  }",
          "state_mutations": [
            "setEditingMessageId(messageId)",
            "setEditText(content)"
          ],
          "api_calls": [],
          "calls": [
            {
              "name": "setEditingMessageId",
              "source": {
                "type": "StateSetter",
                "state_name": "editingMessageId"
              },
              "arguments": [
                "messageId"
              ],
              "is_async": false
            },
            {
              "name": "setEditText",
              "source": {
                "type": "StateSetter",
                "state_name": "editText"
              },
              "arguments": [
                "content"
              ],
              "is_async": false
            }
          ],
          "side_effects": [
            {
              "kind": "StateMutation",
              "target": "setEditingMessageId"
            },
            {
              "kind": "StateMutation",
              "target": "setEditText"
            }
          ],
          "parameters": [
            {
              "name": "messageId",
              "type_annotation": ": string"
            },
            {
              "name": "content",
              "type_annotation": ": string"
            }
          ],
          "has_conditionals": false,
          "has_early_return": false
        },
        {
          "name": "handleCancelEdit",
          "event_type": null,
          "is_async": false,
          "body_summary": "() => {\n    setEditingMessageId(null)\n    setEditText('')\n  }",
          "state_mutations": [
            "setEditingMessageId(null)",
            "setEditText('')"
          ],
          "api_calls": [],
          "calls": [
            {
              "name": "setEditingMessageId",
              "source": {
                "type": "StateSetter",
                "state_name": "editingMessageId"
              },
              "arguments": [
                "null"
              ],
              "is_async": false
            },
            {
              "name": "setEditText",
              "source": {
                "type": "StateSetter",
                "state_name": "editText"
              },
              "arguments": [
                "''"
              ],
              "is_async": false
            }
          ],
          "side_effects": [
            {
              "kind": "StateMutation",
              "target": "setEditingMessageId"
            },
            {
              "kind": "StateMutation",
              "target": "setEditText"
            }
          ],
          "parameters": [],
          "has_conditionals": false,
          "has_early_return": false
        },
        {
          "name": "handleRetry",
          "event_type": null,
          "is_async": false,
          "body_summary": "(messageId: string, originalMessage: string) => {\n    // Remove the error message\n    setMessages(prev => prev.filter(msg => msg.id !== messageId))\n    // Set input and trigger send\n    setInput(originalMessage)\n    setTimeout(() => handleSend(), 100)\n  }",
          "state_mutations": [
            "setMessages(prev => prev.filter(msg => msg.id !== messageId))",
            "setInput(originalMessage)",
            "setTimeout(() => handleSend(), 100)"
          ],
          "api_calls": [],
          "calls": [
            {
              "name": "setMessages",
              "source": {
                "type": "StateSetter",
                "state_name": "messages"
              },
              "arguments": [
                "prev => prev.filter(msg => msg.id !== messageId)"
              ],
              "is_async": false
            },
            {
              "name": "prev.filter",
              "source": {
                "type": "Unknown"
              },
              "arguments": [
                "msg => msg.id !== messageId"
              ],
              "is_async": false
            },
            {
              "name": "setInput",
              "source": {
                "type": "StateSetter",
                "state_name": "input"
              },
              "arguments": [
                "originalMessage"
              ],
              "is_async": false
            },
            {
              "name": "setTimeout",
              "source": {
                "type": "StateSetter",
                "state_name": "timeout"
              },
              "arguments": [
                "() => handleSend()",
                "100"
              ],
              "is_async": false
            },
            {
              "name": "handleSend",
              "source": {
                "type": "Unknown"
              },
              "arguments": [],
              "is_async": false
            }
          ],
          "side_effects": [
            {
              "kind": "StateMutation",
              "target": "setMessages"
            },
            {
              "kind": "StateMutation",
              "target": "setInput"
            },
            {
              "kind": "StateMutation",
              "target": "setTimeout"
            }
          ],
          "parameters": [
            {
              "name": "messageId",
              "type_annotation": ": string"
            },
            {
              "name": "originalMessage",
              "type_annotation": ": string"
            }
          ],
          "has_conditionals": false,
          "has_early_return": false
        },
        {
          "name": "handleSaveEdit",
          "event_type": null,
          "is_async": true,
          "body_summary": "async () => {\n    if (!editingMessageId || !editText.trim()) return\n\n    const messageIndex = messages.findIndex(msg => msg.id === editingMessageId)\n    if (messageIndex === -1) return\n\n    const updatedMessage = { ...messages[messageIndex], content: editText }\n    const messagesToKeep = messages.slice(0, messageIndex)\n    setMessages([...messagesToKeep, updatedMessage])\n\n    setEditingMessageId(null)\n    setEditText('')\n\n    setInput(editText)\n    setTimeout(() => handleSend(), 100)\n  }",
          "state_mutations": [
            "setMessages([...messagesToKeep, updatedMessage])",
            "setEditingMessageId(null)",
            "setEditText('')",
            "setInput(editText)",
            "setTimeout(() => handleSend(), 100)"
          ],
          "api_calls": [],
          "calls": [
            {
              "name": "messages.findIndex",
              "source": {
                "type": "Unknown"
              },
              "arguments": [
                "msg => msg.id === editingMessageId"
              ],
              "is_async": false
            },
            {
              "name": "messages.slice",
              "source": {
                "type": "Unknown"
              },
              "arguments": [
                "0",
                "messageIndex"
              ],
              "is_async": false
            },
            {
              "name": "setMessages",
              "source": {
                "type": "StateSetter",
                "state_name": "messages"
              },
              "arguments": [
                "[...messagesToKeep, updatedMessage]"
              ],
              "is_async": false
            },
            {
              "name": "setEditingMessageId",
              "source": {
                "type": "StateSetter",
                "state_name": "editingMessageId"
              },
              "arguments": [
                "null"
              ],
              "is_async": false
            },
            {
              "name": "setEditText",
              "source": {
                "type": "StateSetter",
                "state_name": "editText"
              },
              "arguments": [
                "''"
              ],
              "is_async": false
            },
            {
              "name": "setInput",
              "source": {
                "type": "StateSetter",
                "state_name": "input"
              },
              "arguments": [
                "editText"
              ],
              "is_async": false
            },
            {
              "name": "setTimeout",
              "source": {
                "type": "StateSetter",
                "state_name": "timeout"
              },
              "arguments": [
                "() => handleSend()",
                "100"
              ],
              "is_async": false
            },
            {
              "name": "handleSend",
              "source": {
                "type": "Unknown"
              },
              "arguments": [],
              "is_async": false
            }
          ],
          "side_effects": [
            {
              "kind": "StateMutation",
              "target": "setMessages"
            },
            {
              "kind": "StateMutation",
              "target": "setEditingMessageId"
            },
            {
              "kind": "StateMutation",
              "target": "setEditText"
            },
            {
              "kind": "StateMutation",
              "target": "setInput"
            },
            {
              "kind": "StateMutation",
              "target": "setTimeout"
            }
          ],
          "parameters": [],
          "has_conditionals": true,
          "has_early_return": false
        },
        {
          "name": "handleKeyDown",
          "event_type": null,
          "is_async": false,
          "body_summary": "(e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }",
          "state_mutations": [],
          "api_calls": [],
          "calls": [
            {
              "name": "e.preventDefault",
              "source": {
                "type": "Unknown"
              },
              "arguments": [],
              "is_async": false
            },
            {
              "name": "handleSend",
              "source": {
                "type": "Unknown"
              },
              "arguments": [],
              "is_async": false
            }
          ],
          "side_effects": [],
          "parameters": [
            {
              "name": "e",
              "type_annotation": ": React.KeyboardEvent"
            }
          ],
          "has_conditionals": true,
          "has_early_return": false
        }
      ],
      "child_components": [
        "AlertTriangle",
        "Button",
        "FileText",
        "Flame",
        "Loader2",
        "Plus",
        "Send",
        "Shield",
        "Textarea",
        "X",
        "Zap"
      ],
      "architecture": {
        "service_actors": [],
        "state_ownership": [
          {
            "state_name": "messages",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "input",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "contextItems",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "isGenerating",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "conversationId",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "executionMode",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "strictMode",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "braveMode",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "editingMessageId",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          },
          {
            "state_name": "editText",
            "owner": "Self",
            "access_pattern": "local",
            "source": "useState"
          }
        ],
        "communication_patterns": [],
        "zustand_stores": []
      }
    }
  },
  "target": {
    "suggested_path": "src/components/intelli_j_style_chat.sigil",
    "pattern": "actor"
  },
  "recommendations": {
    "state_fields": [
      {
        "from_hook": "useState:messages",
        "to_field": "messages",
        "field_type": "Vec<Any>",
        "evidentiality": "!",
        "initial_value": "[]",
        "reasoning": "useState hook 'messages' maps to actor state field"
      },
      {
        "from_hook": "useState:input",
        "to_field": "input",
        "field_type": "String",
        "evidentiality": "!",
        "initial_value": "\"\"",
        "reasoning": "useState hook 'input' maps to actor state field"
      },
      {
        "from_hook": "useState:contextItems",
        "to_field": "contextItems",
        "field_type": "Vec<Any>",
        "evidentiality": "!",
        "initial_value": "[]",
        "reasoning": "useState hook 'contextItems' maps to actor state field"
      },
      {
        "from_hook": "useState:isGenerating",
        "to_field": "isGenerating",
        "field_type": "bool",
        "evidentiality": "!",
        "initial_value": "false",
        "reasoning": "useState hook 'isGenerating' maps to actor state field"
      },
      {
        "from_hook": "useState:conversationId",
        "to_field": "conversationId",
        "field_type": "Option<Any>",
        "evidentiality": "~",
        "initial_value": "null",
        "reasoning": "useState hook 'conversationId' maps to actor state field"
      },
      {
        "from_hook": "useState:executionMode",
        "to_field": "executionMode",
        "field_type": "String",
        "evidentiality": "!",
        "initial_value": "\"execute\"",
        "reasoning": "useState hook 'executionMode' maps to actor state field"
      },
      {
        "from_hook": "useState:strictMode",
        "to_field": "strictMode",
        "field_type": "bool",
        "evidentiality": "!",
        "initial_value": "false",
        "reasoning": "useState hook 'strictMode' maps to actor state field"
      },
      {
        "from_hook": "useState:braveMode",
        "to_field": "braveMode",
        "field_type": "bool",
        "evidentiality": "!",
        "initial_value": "false",
        "reasoning": "useState hook 'braveMode' maps to actor state field"
      },
      {
        "from_hook": "useState:editingMessageId",
        "to_field": "editingMessageId",
        "field_type": "Option<Any>",
        "evidentiality": "~",
        "initial_value": "null",
        "reasoning": "useState hook 'editingMessageId' maps to actor state field"
      },
      {
        "from_hook": "useState:editText",
        "to_field": "editText",
        "field_type": "String",
        "evidentiality": "!",
        "initial_value": "\"\"",
        "reasoning": "useState hook 'editText' maps to actor state field"
      },
      {
        "from_hook": "useRef:messagesEndRef",
        "to_field": "messagesEndRef",
        "field_type": "Option<HTMLDivElement>",
        "evidentiality": "!",
        "initial_value": "âˆ…",
        "reasoning": "useRef 'messagesEndRef' becomes non-reactive state (no re-render on change)"
      },
      {
        "from_hook": "useRef:textareaRef",
        "to_field": "textareaRef",
        "field_type": "Option<HTMLTextAreaElement>",
        "evidentiality": "!",
        "initial_value": "âˆ…",
        "reasoning": "useRef 'textareaRef' becomes non-reactive state (no re-render on change)"
      },
      {
        "from_hook": "useRef:fileInputRef",
        "to_field": "fileInputRef",
        "field_type": "Option<Element>",
        "evidentiality": "!",
        "initial_value": "âˆ…",
        "reasoning": "useRef 'fileInputRef' becomes non-reactive state (no re-render on change)"
      }
    ],
    "messages": [
      {
        "name": "UpdateMessages",
        "from_handler": "setMessages",
        "payload": null,
        "state_changes": [
          "self.messages = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateInput",
        "from_handler": "setInput",
        "payload": null,
        "state_changes": [
          "self.input = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateContextItems",
        "from_handler": "setContextItems",
        "payload": null,
        "state_changes": [
          "self.contextItems = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateIsGenerating",
        "from_handler": "setIsGenerating",
        "payload": null,
        "state_changes": [
          "self.isGenerating = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateConversationId",
        "from_handler": "setConversationId",
        "payload": null,
        "state_changes": [
          "self.conversationId = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateExecutionMode",
        "from_handler": "setExecutionMode",
        "payload": null,
        "state_changes": [
          "self.executionMode = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateStrictMode",
        "from_handler": "setStrictMode",
        "payload": null,
        "state_changes": [
          "self.strictMode = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateBraveMode",
        "from_handler": "setBraveMode",
        "payload": null,
        "state_changes": [
          "self.braveMode = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateEditingMessageId",
        "from_handler": "setEditingMessageId",
        "payload": null,
        "state_changes": [
          "self.editingMessageId = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "UpdateEditText",
        "from_handler": "setEditText",
        "payload": null,
        "state_changes": [
          "self.editText = /* new value */"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "AttachClick",
        "from_handler": "handleAttachClick",
        "payload": null,
        "state_changes": [],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "FileChange",
        "from_handler": "handleFileChange",
        "payload": null,
        "state_changes": [],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "Send",
        "from_handler": "handleSend",
        "payload": null,
        "state_changes": [
          "self.messages = prev => [...prev, userMessage]",
          "self.input = ''",
          "self.isGenerating = true",
          "self.messages = prev => [...prev, assistantMessage]"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "EditMessage",
        "from_handler": "handleEditMessage",
        "payload": null,
        "state_changes": [
          "self.editingMessageId = messageId",
          "self.editText = content"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "CancelEdit",
        "from_handler": "handleCancelEdit",
        "payload": null,
        "state_changes": [
          "self.editingMessageId = null",
          "self.editText = ''"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "Retry",
        "from_handler": "handleRetry",
        "payload": null,
        "state_changes": [
          "self.messages = prev => prev.filter(msg => msg.id !== messageId)",
          "self.input = originalMessage",
          "setTimeout(() => handleSend(), 100)"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "SaveEdit",
        "from_handler": "handleSaveEdit",
        "payload": null,
        "state_changes": [
          "self.messages = [...messagesToKeep, updatedMessage]",
          "self.editingMessageId = null",
          "self.editText = ''",
          "self.input = self.editText",
          "setTimeout(() => handleSend(), 100)"
        ],
        "side_effects": [],
        "service_calls": []
      },
      {
        "name": "KeyDown",
        "from_handler": "handleKeyDown",
        "payload": null,
        "state_changes": [],
        "side_effects": [],
        "service_calls": []
      }
    ],
    "effects": [
      {
        "from_hook": "useEffect[messages]",
        "strategy": "inline",
        "reasoning": "Deps [messages] â†’ inline in handlers that change these",
        "inline_in": "messages",
        "lifecycle_event": null
      }
    ],
    "props_handling": {
      "strategy": "constructor",
      "fields": [
        {
          "name": "persona_code",
          "field_type": "Any",
          "from_prop": "personaCode"
        },
        {
          "name": "on_file_reference",
          "field_type": "Any",
          "from_prop": "onFileReference"
        }
      ]
    }
  },
  "patterns": [
    {
      "name": "useState_to_state",
      "description": "Convert useState hook to actor state field",
      "react": "const [count, setCount] = useState(0);",
      "sigil": "state count: i32! = 0,"
    },
    {
      "name": "useRef_to_state",
      "description": "Convert useRef to non-reactive state field",
      "react": "const inputRef = useRef<HTMLInputElement>(null);",
      "sigil": "state input_ref: Option<Element>! = âˆ…,"
    },
    {
      "name": "useEffect_deps",
      "description": "Convert useEffect with deps to inline in message handler",
      "react": "useEffect(() => { save(count); }, [count]);",
      "sigil": "// Inline in the message that changes count:\non Increment { self.count += 1; self.save(); }"
    },
    {
      "name": "jsx_to_builder",
      "description": "Convert JSX element to VNode builder",
      "react": "<div className=\"container\" id=\"main\">\n  <h1>Title</h1>\n  <p>Content</p>\n</div>",
      "sigil": "VNodeÂ·div()\n    Â·class(\"container\")\n    Â·id(\"main\")\n    Â·child(VNodeÂ·h1()Â·text(\"Title\"))\n    Â·child(VNodeÂ·p()Â·text(\"Content\"))"
    },
    {
      "name": "onClick_to_message",
      "description": "Convert onClick handler to message dispatch",
      "react": "<button onClick={() => setCount(c => c + 1)}>",
      "sigil": "VNodeÂ·button()Â·on_click(Increment)"
    }
  ],
  "ambiguities": [
    {
      "id": "effect_13",
      "category": "effect_placement",
      "question": "Where should the effect with deps [messages] be placed?",
      "options": [
        {
          "label": "Inline in handlers",
          "description": "Add effect logic to message handlers that change the dependencies",
          "recommended": true
        },
        {
          "label": "Separate message",
          "description": "Create a dedicated message for the effect logic",
          "recommended": false
        }
      ],
      "default_choice": 0
    },
    {
      "id": "callback_prop_onFileReference",
      "category": "event_mapping",
      "question": "How should callback prop 'onFileReference' be handled?",
      "options": [
        {
          "label": "Message dispatch",
          "description": "Parent passes a message ID, child dispatches to parent",
          "recommended": true
        },
        {
          "label": "Actor reference",
          "description": "Parent passes a reference, child sends messages to parent actor",
          "recommended": false
        }
      ],
      "default_choice": 0
    }
  ],
  "dependencies": {
    "components": [
      "AlertTriangle",
      "Button",
      "FileText",
      "Flame",
      "Loader2",
      "Plus",
      "Send",
      "Shield",
      "Textarea",
      "X",
      "Zap"
    ],
    "types": []
  },
  "complexity": "complex",
  "complexity_factors": [
    "10 state variables",
    "8 event handlers"
  ],
  "status": "pending"
}